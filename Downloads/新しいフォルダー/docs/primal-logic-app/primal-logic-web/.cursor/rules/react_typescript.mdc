---
description: React + TypeScript + Vite プロジェクト固有のコード品質ルール
globs: ["src/**/*.tsx", "src/**/*.ts"]
alwaysApply: false
---

# React + TypeScript + Vite コード品質ルール

**⚠️ 重要: このルールファイルは`.cursor/rules/master_rule.mdc`と併用されます。**
**`master_rule.mdc`の全ルール（全セクション）が優先されます。このファイルはReact/TypeScript固有の追加ルールです。**

このルールは、React + TypeScript + Viteプロジェクトで使用するコード品質基準を定義します。

## TypeScript型安全性

### 禁止事項
- ❌ **`any`型の使用**: 型が不明な場合は`unknown`を使用し、型ガードで安全に扱う
- ❌ **`@ts-ignore`や`@ts-expect-error`の使用**: 型エラーは修正する
- ❌ **暗黙の`any`**: TypeScriptの`strict: true`を維持し、暗黙の`any`を許可しない

### 推奨事項
- ✅ **厳密な型定義**: 関数の引数と戻り値に明示的に型を指定
- ✅ **型ガードの使用**: `unknown`型を扱う際は型ガードを使用
- ✅ **ユニオン型の活用**: `string | null`のように明示的にnullを扱う

## コードのクリーンアップ

### 禁止事項
- ❌ **`console.log`の残存**: デバッグ用の`console.log`は本番コードに残さない
- ❌ **`TODO`や`FIXME`コメント**: 実装するか削除する（残さない）
- ❌ **未使用のコード**: import、変数、関数、ファイルを削除

### 推奨事項
- ✅ **エラーログの使用**: 本番環境では`src/utils/errorHandler.ts`の`logError`を使用
- ✅ **コメントの明確化**: 必要なコメントは日本語で明確に記述
- ✅ **コードの整理**: 定期的に未使用コードを削除

## Reactコンポーネント

### コンポーネント設計
- ✅ **関数コンポーネント**: クラスコンポーネントではなく関数コンポーネントを使用
- ✅ **カスタムフック**: ロジックの再利用はカスタムフック（`src/hooks/`）に分離
- ✅ **コンポーネントの分割**: 大きなコンポーネントは小さく分割

### パフォーマンス最適化
- ✅ **レイジーローディング**: 重いコンポーネントは`React.lazy`で遅延読み込み
- ✅ **メモ化**: `useMemo`、`useCallback`を適切に使用（過度な使用は避ける）
- ✅ **コード分割**: ルートレベルでコード分割を実装

### 状態管理
- ✅ **Context API**: グローバル状態は`src/context/`で管理
- ✅ **ローカル状態**: コンポーネント固有の状態は`useState`で管理
- ✅ **状態のリフトアップ**: 必要に応じて状態を親コンポーネントにリフトアップ

## Vite特有のルール

### ビルド最適化
- ✅ **環境変数**: `VITE_`プレフィックスを使用（`import.meta.env.VITE_*`）
- ✅ **静的アセット**: `public/`ディレクトリに配置
- ✅ **動的インポート**: 必要に応じて動的インポートを使用

### 開発サーバー
- ✅ **ポート番号**: デフォルトポート（5173）を使用、競合時は自動的に次のポートを使用
- ✅ **HMR**: Hot Module Replacementを活用

## エラーハンドリング

### 必須事項
- ✅ **try-catch**: 全ての`async`関数に`try-catch`を実装
- ✅ **エラーログ**: `src/utils/errorHandler.ts`の`logError`を使用
- ✅ **ユーザーフレンドリーなエラーメッセージ**: `getUserFriendlyErrorMessage`を使用

### 禁止事項
- ❌ **エラーの無視**: エラーを`catch`して何もしない（最低限ログを記録）
- ❌ **エラーの隠蔽**: エラーメッセージを表示せずに処理を続行

## テスト

### 必須事項
- ✅ **E2Eテスト**: Playwrightを使用（`npm run test`）
- ✅ **型チェック**: `npx tsc --noEmit`で型エラーを確認
- ✅ **Lintチェック**: `npm run lint`でコード品質を確認

## 参照ファイル

- `src/utils/errorHandler.ts` - エラーハンドリングユーティリティ
- `src/context/` - グローバル状態管理
- `src/hooks/` - カスタムフック
- `package.json` - 依存関係とスクリプト

---

**最終更新**: 2026-01-21
