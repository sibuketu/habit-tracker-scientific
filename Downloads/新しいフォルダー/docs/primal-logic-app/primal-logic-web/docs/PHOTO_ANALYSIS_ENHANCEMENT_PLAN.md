# 写真解析機�E強化計画

**作�E日**: 2026-01-22  
**目皁E*: 写真解析機�Eの品質を最大限に向上させる�E�Eursorの限界まで�E�E

---

## 1. 現状刁E��

### 1.1 現在の実裁E

- **解析エンジン**: Gemini 2.5 Flash API
- **主要機�E**:
  - `analyzeFoodImage()`: 写真から食品名、E��量、栁E��素を推測
  - `refineFoodAnalysis()`: ユーザーの回答に基づぁE��解析結果を�E計箁E
  - `analyzeFoodName()`: 食品名から栁E��素を推測
- **UI**: PhotoAnalysisModalで解析結果を表示・編雁E�E確誁E

### 1.2 現在の問題点

1. **解析精度**: 食品名が曖昧�E�「肉」「魚」など�E�E
2. **重量推宁E*: 視覚的なサイズから推定するが精度が低い
3. **栁E��素チE�Eタ**: 一部の栁E��素が欠落してぁE��可能性
4. **エラーハンドリング**: 解析失敗時の処琁E��不十刁E
5. **解析速度**: 画像サイズが大きいと時間がかかる
6. **褁E��食品**: 褁E��の食品が�EってぁE��場合�E対応が不十刁E

---

## 2. 強化頁E���E�優先頁E��頁E��E

### 2.1 最高優先度�E�忁E��！E

#### 1. 画像前処琁E��画像サイズ最適化！E
- **冁E��**: 画像を解析前にリサイズ・圧縮して、API呼び出しを高速化
- **実裁E��釁E*:
  - 最大解像度: 1024x1024px
  - JPEG品質: 85%
  - 画像サイズ: 500KB以下に圧縮
- **メリチE��**: 解析速度が向上、APIコスト削渁E

#### 2. プロンプト改喁E��解析精度向上！E
- **冁E��**: Gemini APIへのプロンプトを改喁E��て、解析精度を向丁E
- **実裁E��釁E*:
  - 食品名�E具体性を強調�E�「肉」ではなく「リブアイスチE�Eキ」！E
  - 重量推定�E精度向上（参照物との比輁E��持E���E�E
  - 栁E��素チE�Eタの完�E性を強調�E�可能な限り多くの栁E��素を含める�E�E
  - カーニ�EアダイエチE��の斁E��を強匁E
- **メリチE��**: 解析精度が向上、ユーザー体験が改喁E

#### 3. エラーハンドリング強匁E
- **冁E��**: 解析失敗時の処琁E��改喁E
- **実裁E��釁E*:
  - リトライ機�E�E�最大3回！E
  - エラーメチE��ージの改喁E��ユーザーフレンドリーなメチE��ージ�E�E
  - フォールバック処琁E��解析失敗時は手動入力に誘導！E
- **メリチE��**: ユーザー体験が改喁E��エラー時�E対応が明確

#### 4. 重量推定精度向丁E
- **冁E��**: 重量推定�E精度を向丁E
- **実裁E��釁E*:
  - 参�E物との比輁E��プロンプトに追加�E�コイン、手、フォークなど�E�E
  - ユーザーに重量を確認�E修正できるUIを強匁E
- **メリチE��**: 栁E��素計算�E精度が向丁E

### 2.2 高優先度�E�推奨�E�E

#### 5. 栁E��素チE�Eタの完�E性向丁E
- **冁E��**: 可能な限り多くの栁E��素を含める
- **実裁E��釁E*:
  - プロンプトに全栁E��素リストを明示
  - カーニ�EアダイエチE��で重要な栁E��素を優允E
- **メリチE��**: 栁E��管琁E�E精度が向丁E

#### 6. 褁E��食品検�E
- **冁E��**: 褁E��の食品が�EってぁE��場合に対忁E
- **実裁E��釁E*:
  - プロンプトに褁E��食品検�Eを指示
  - 解析結果を�E列で返す
  - UIで褁E��食品を選択可能にする
- **メリチE��**: より実用皁E��機�EになめE

#### 7. 解析速度向丁E
- **冁E��**: 解析速度を向丁E
- **実裁E��釁E*:
  - 画像前処琁E��リサイズ・圧縮�E�E
  - プログレスバ�Eの表示
  - キャチE��ュ機�E�E�同じ画像�E再解析を避ける�E�E
- **メリチE��**: ユーザー体験が改喁E

#### 8. UI/UX改喁E
- **冁E��**: PhotoAnalysisModalのUI/UXを改喁E
- **実裁E��釁E*:
  - 解析中のローチE��ング表示を改喁E
  - 解析結果の表示を改喁E��グループ化、視覚的階層�E�E
  - 重量調整のUIを改喁E��スライダー、数値入力！E
- **メリチE��**: ユーザー体験が改喁E

### 2.3 中優先度�E�検討！E

#### 9. 解析結果の検証機�E
- **冁E��**: 解析結果の精度を検証
- **実裁E��釁E*:
  - 食品マスターチE�Eタとの比輁E
  - 異常値の検�E�E�侁E タンパク質が異常に高い�E�E
  - 警告表示
- **メリチE��**: 解析精度が向丁E

#### 10. 解析履歴の保孁E
- **冁E��**: 解析履歴を保存して、�E解析を避ける
- **実裁E��釁E*:
  - 画像�Eハッシュ値を計箁E
  - 同じ画像�E再解析時は履歴から取征E
- **メリチE��**: 解析速度が向上、APIコスト削渁E

---

## 3. 実裁E��頁E

### Phase 1: 画像前処琁E��最高優先度�E�E
1. 画像リサイズ関数の実裁E
2. 画像圧縮関数の実裁E
3. `analyzeFoodImage()`に前�E琁E��追加

### Phase 2: プロンプト改喁E��最高優先度�E�E
1. プロンプトチE��プレート�E改喁E
2. 食品名�E具体性を強調
3. 重量推定�E精度向丁E
4. 栁E��素チE�Eタの完�E性を強調

### Phase 3: エラーハンドリング強化（最高優先度�E�E
1. リトライ機�Eの実裁E
2. エラーメチE��ージの改喁E
3. フォールバック処琁E�E実裁E

### Phase 4: 重量推定精度向上（最高優先度�E�E
1. プロンプトに参�E物との比輁E��追加
2. UIで重量確認�E修正機�Eを強匁E

### Phase 5: 栁E��素チE�Eタの完�E性向上（高優先度�E�E
1. プロンプトに全栁E��素リストを明示
2. カーニ�EアダイエチE��で重要な栁E��素を優允E

### Phase 6: 褁E��食品検�E�E�高優先度�E�E
1. プロンプトに褁E��食品検�Eを指示
2. 解析結果を�E列で返す
3. UIで褁E��食品を選択可能にする

### Phase 7: 解析速度向上（高優先度�E�E
1. プログレスバ�Eの表示
2. キャチE��ュ機�Eの実裁E

### Phase 8: UI/UX改喁E��高優先度�E�E
1. 解析中のローチE��ング表示を改喁E
2. 解析結果の表示を改喁E
3. 重量調整のUIを改喁E

---

## 4. 完亁E��件

- [ ] 画像前処琁E��実裁E��れてぁE���E�リサイズ・圧縮�E�E
- [ ] プロンプトが改喁E��れてぁE���E�解析精度向上！E
- [ ] エラーハンドリングが強化されてぁE���E�リトライ、エラーメチE��ージ、フォールバック�E�E
- [ ] 重量推定精度が向上してぁE���E�参照物との比輁E��E
- [ ] 栁E��素チE�Eタの完�E性が向上してぁE���E��E栁E��素リスト！E
- [ ] 褁E��食品検�Eが実裁E��れてぁE���E�オプション�E�E
- [ ] 解析速度が向上してぁE���E��Eログレスバ�E、キャチE��ュ�E�E
- [ ] UI/UXが改喁E��れてぁE���E�ローチE��ング、結果表示、E��量調整�E�E

---

## 5. 参老E��E��

- [src/services/aiService.ts](src/services/aiService.ts) - `analyzeFoodImage()`関数
- [src/components/PhotoAnalysisModal.tsx](src/components/PhotoAnalysisModal.tsx) - PhotoAnalysisModalコンポ�EネンチE
- [IMPROVEMENT_IDEAS.md](IMPROVEMENT_IDEAS.md) - 改喁E��イチE��

---

**使用したRules**: #0, #1, #2, #3, #4, #6, #8, #10

