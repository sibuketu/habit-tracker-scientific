# Phase 1: 移行期間サポート機能 - 手動チェック手順

> 作成日: 2025-01-20
> 対象: Phase 1の全機能

---

## 前提条件

1. 開発サーバーが起動している（`npm run dev`）
2. ブラウザで `http://localhost:5174` を開いている
3. ブラウザの開発者ツール（F12）を開いている（コンソールエラーを確認するため）

---

## チェック手順

### 1. 動的栄養素調整システムの確認

#### 1.1 移行期間中の栄養素目標値の確認

1. **ローカルストレージを設定**
   - 開発者ツール（F12）を開く
   - 「Application」タブ（Chrome）または「ストレージ」タブ（Firefox）を開く
   - 「Local Storage」→ `http://localhost:5174` を選択
   - 以下のキーを追加/編集:
     ```
     primal_logic_user_profile
     値: {"gender":"male","goal":"healing","metabolicStatus":"transitioning","daysOnCarnivore":15,"carnivoreStartDate":"2025-01-05"}
     ```

2. **ページをリロード**
   - F5キーを押すか、ブラウザのリロードボタンをクリック

3. **栄養素目標値の確認**
   - HomeScreenでナトリウム、マグネシウム、カリウムのゲージを確認
   - **期待値**:
     - ナトリウム: 7000mg（基本5000mg + 2000mg）
     - マグネシウム: 800mg（基本600mg + 200mg）
     - カリウム: 5000mg（基本4500mg + 500mg）

4. **移行期間終了後の確認**
   - ローカルストレージの`daysOnCarnivore`を`35`に変更
   - ページをリロード
   - **期待値**: 栄養素目標値が基本値に戻る
     - ナトリウム: 5000mg
     - マグネシウム: 600mg
     - カリウム: 4500mg

---

### 2. 移行期間バナーの確認

#### 2.1 バナーの表示確認（移行期間中）

1. **ローカルストレージを設定**（1.1と同じ）
   ```
   primal_logic_user_profile
   値: {"gender":"male","goal":"healing","metabolicStatus":"transitioning","daysOnCarnivore":15,"carnivoreStartDate":"2025-01-05"}
   ```

2. **ページをリロード**

3. **バナーの表示確認**
   - HomeScreenの上部に青いバナーが表示されることを確認
   - **期待値**:
     - 「移行期間: 15/30日（50%）」と表示
     - 「適応モード: 塩分目標を増量中」と表示
     - 「あと15日で移行期間終了」と表示（残り日数が正しい）

#### 2.2 バナーの非表示確認（移行期間終了後）

1. **ローカルストレージを設定**
   ```
   primal_logic_user_profile
   値: {"gender":"male","goal":"healing","metabolicStatus":"adapted","daysOnCarnivore":35,"carnivoreStartDate":"2024-12-15"}
   ```

2. **ページをリロード**

3. **バナーの非表示確認**
   - **期待値**: バナーが表示されない

---

### 3. 移行期間ガイド画面（モーダル）の確認

#### 3.1 モーダルの表示確認

1. **ローカルストレージを設定**（1.1と同じ）
   ```
   primal_logic_user_profile
   値: {"gender":"male","goal":"healing","metabolicStatus":"transitioning","daysOnCarnivore":15,"carnivoreStartDate":"2025-01-05"}
   ```

2. **ページをリロード**

3. **バナーをタップ**
   - 移行期間バナーをクリック

4. **モーダルの表示確認**
   - **期待値**:
     - モーダルが画面中央に表示される
     - 「移行期間ガイド」というタイトルが表示される
     - 「×」ボタンが右上に表示される

#### 3.2 セクション1: 移行期間の説明の確認

1. **モーダルを開く**（3.1の手順）

2. **セクション1の確認**
   - **期待値**:
     - 「移行期間について」という見出しが表示される
     - 説明文が表示される
     - 進捗バーが表示される（15/30日、50%）

#### 3.3 セクション2: よくある症状と対処法の確認

1. **モーダルを開く**（3.1の手順）

2. **症状ボタンの確認**
   - **期待値**: 5つの症状ボタンが表示される
     - 頭痛
     - こむら返り
     - 疲労感
     - 便秘
     - 下痢

3. **症状を選択して対処法を確認**
   - 「頭痛」ボタンをクリック
   - **期待値**:
     - 「頭痛の対処法」という見出しが表示される
     - 「ナトリウム +2000mg」と表示される
     - 説明文が表示される
     - 「推奨食品: 塩、肉汁、骨スープ」と表示される

4. **他の症状も確認**
   - 「こむら返り」をクリック
   - **期待値**: 「マグネシウム +200mg」と表示される
   - 「疲労感」をクリック
   - **期待値**: 「脂質 +50g」「ナトリウム +1000mg」と表示される

#### 3.4 セクション3: 推奨食品の確認

1. **モーダルを開く**（3.1の手順）

2. **推奨食品の確認**
   - **期待値**: 4つのカテゴリが表示される
     - 内臓肉（レバー、腎臓、心臓）
     - 脂身の多い肉（リブアイ、バラ肉）
     - 卵（特に卵黄）
     - 魚（サーモン、マグロ）

#### 3.5 モーダルの閉じる機能の確認

1. **モーダルを開く**（3.1の手順）

2. **「×」ボタンをクリック**
   - **期待値**: モーダルが閉じる

3. **モーダル外をクリック**
   - モーダルの背景（暗い部分）をクリック
   - **期待値**: モーダルが閉じる

---

### 4. 手動オーバーライド機能の確認（将来的に）

#### 4.1 強制ONの確認

1. **ローカルストレージを設定**
   ```
   primal_logic_user_profile
   値: {"gender":"male","goal":"healing","metabolicStatus":"adapted","daysOnCarnivore":35,"carnivoreStartDate":"2024-12-15","forceAdaptationMode":true}
   ```

2. **ページをリロード**

3. **確認**
   - **期待値**: 移行期間バナーが表示される（移行期間終了後でも）
   - **期待値**: 栄養素目標値が移行期間中の値になる

#### 4.2 強制OFFの確認

1. **ローカルストレージを設定**
   ```
   primal_logic_user_profile
   値: {"gender":"male","goal":"healing","metabolicStatus":"transitioning","daysOnCarnivore":15,"carnivoreStartDate":"2025-01-05","forceAdaptationMode":false}
   ```

2. **ページをリロード**

3. **確認**
   - **期待値**: 移行期間バナーが表示されない（移行期間中でも）
   - **期待値**: 栄養素目標値が基本値になる

---

## エラーチェック

### コンソールエラーの確認

1. **開発者ツール（F12）を開く**
2. **「Console」タブを開く**
3. **ページをリロード**
4. **確認**:
   - エラーメッセージが表示されていないか
   - 警告メッセージが表示されていないか

### ネットワークエラーの確認

1. **開発者ツール（F12）を開く**
2. **「Network」タブを開く**
3. **ページをリロード**
4. **確認**:
   - 404エラー（ファイルが見つからない）がないか
   - 500エラー（サーバーエラー）がないか

---

## 確認チェックリスト

- [ ] 移行期間中の栄養素目標値が正しく調整される（ナトリウム7000mg、マグネシウム800mg、カリウム5000mg）
- [ ] 移行期間終了後、栄養素目標値が基本値に戻る
- [ ] 移行期間バナーが表示される（移行期間中）
- [ ] 移行期間バナーが表示されない（移行期間終了後）
- [ ] バナーをタップするとモーダルが開く
- [ ] モーダルに3つのセクションが表示される
- [ ] 症状を選択すると対処法が表示される
- [ ] 推奨食品が正しく表示される
- [ ] モーダルが閉じる（「×」ボタン、背景クリック）
- [ ] コンソールエラーがない
- [ ] ネットワークエラーがない

---

## トラブルシューティング

### バナーが表示されない場合

1. ローカルストレージの`daysOnCarnivore`が30未満か確認
2. ローカルストレージの`carnivoreStartDate`が正しい形式（YYYY-MM-DD）か確認
3. ブラウザのコンソールでエラーを確認

### モーダルが開かない場合

1. バナーが表示されているか確認
2. バナーをクリックした時にコンソールエラーが出ていないか確認
3. `showTransitionGuide`の状態を確認（React DevTools）

### 栄養素目標値が調整されない場合

1. `getCarnivoreTargets`関数に`forceAdaptationMode`パラメータが正しく渡されているか確認
2. `isAdaptationPhase`の判定ロジックが正しく動作しているか確認
3. ブラウザのコンソールでエラーを確認

---

## 自動チェックについて

自動チェックは`tests/phase1-transition-check.spec.ts`に実装済みです。

**実行方法**:
```bash
cd primal-logic-app/primal-logic-web
npm run test
```

**注意**: 自動チェックは、ローカルストレージの設定やUIの構造に依存するため、実際のUI構造に合わせてセレクターを調整する必要がある場合があります。

