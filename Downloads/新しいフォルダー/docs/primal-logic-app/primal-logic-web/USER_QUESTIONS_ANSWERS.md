# ユーザー質問への回答

## 1. UIモード切り替えボタンの修正 ✅

**問題**: 💬ボタンを押したら全画面になるのはめんどくさい、2個あるのはおかしい

**解決策**: 
- 1つのボタン（⛶）で全画面/通常サイズを切り替え
- 全画面表示時のみ💬ボタンを表示（フロートUIに切り替え可能に）

## 2. 誠実さスコアの実装方針

**質問**: 適当なはりぼては禁止ってRulesにあったっけ？

**回答**: 
- Rulesには「UIと機能の同時実装」というルールがある（見た目だけの「はりぼて」は禁止）
- 誠実さスコアは**実装が必要な機能**であり、はりぼてではない
- 実装方法:
  1. 記録方法に応じたスコア算出（写真70%、AI深掘り90%、手動入力ペナルティ）
  2. 外部API連携（天気API、ヘルスケアアプリ）で自動取得
  3. 「していないこと」の記録（チェックリスト）
  4. 10%の不確実性を認める（100%にはしない）

## 3. 栄養素貯蔵タンク（既に実装済み）

**質問**: 4（栄養素貯蔵タンク）は既にあるのでは？

**回答**: 
- ✅ `StorageNutrientGauge`コンポーネントが既に実装済み
- 現在は1週間単位での可視化
- Geminiは「1か月規模の栄養素」と言っていたが、現在は1週間単位
- **拡張が必要**: 1か月単位での可視化に拡張する必要がある

## 4. AI対話の自然な実行

**質問**: 特定の機能というより普通にチャットでそういうこと言われたらやれば

**回答**: 
- ✅ 既に実装済み: `chatWithAIStructured`で`todos`と`update_input`アクションを処理
- AIが自然言語を解析して、適切なアクションを実行
- 例: 「肉300g食った」→ 食品追加、「記録して」→ 前回の記録を実行

## 5. 画像解析のフォローアップ質問

**質問**: 画像のやつちょい問題ある → 説明しちゃってるとかもだけど肉しか言ってないのに牛肉とか

**回答**: 
- **問題**: AIが推測で「牛肉」と判断している
- **解決策**: フォローアップ質問を実装
  - 「これは牛肉ですか？豚肉ですか？鶏肉ですか？」
  - 「部位はどれですか？（サーロイン、ロース、モモなど）」
  - 「量はどのくらいですか？」
- **実装場所**: `analyzeFoodImage`関数内で、不確実な場合はフォローアップ質問を生成

## 6. ClaudeCodeのSkillsについて

**質問**: ClaudeCodeのSkills使えばもう自動で色々できるのかな？課金しないとそもそも無理？

**回答**: 
- ClaudeCodeのSkillsは有料プランが必要な可能性が高い
- 現在の実装（Gemini API + 構造化レスポンス）で十分対応可能
- Skillsを使わなくても、`chatWithAIStructured`で`todos`と`update_input`アクションを処理できる
- **推奨**: 現在の実装を継続し、必要に応じて拡張

## 7. 3つのログモード

**質問**: 3つのログモードって何？

**回答**: 
`CARNIVOS_GEMINI_CONVERSATION_SUMMARY.md`より:

1. **アプリ外情報源を含むAIモード**: 全ての情報源（論文、専門家の主張など）を含む
2. **実践者ログ＋AIモード**: アプリ内の実践者のログとAIの組み合わせ
3. **ログ単体モード**: 実践者のログのみ

**実装状況**: 
- 現在は`aiMode: 'purist' | 'realist'`で2つのモードを実装
- 3つ目の「ログ単体モード」は未実装
- **実装が必要**: 3つのモードを完全に実装する必要がある

## 8. 誠実さスコアの表示方法

**質問**: 6（誠実さスコアの表示）どうやって？

**回答**: 
**実装方法**:

1. **スコア算出ロジック**:
   ```typescript
   // 記録方法に応じたスコア
   - 写真撮影: 70%
   - AI深掘り質問に回答: 90%
   - 外部連携（天気、運動）: 自動取得（100%）
   - 手動入力: ペナルティ（-10%）
   - 「していないこと」の記録: チェックリスト化
   ```

2. **表示場所**:
   - 日次ログ画面に表示
   - AIチャットで「誠実さスコア確認」と言われたら表示
   - ツールメニューから確認可能に

3. **外部API連携**:
   - 天気API × 位置情報 × 外出時間
   - ヘルスケアアプリから自動取得

## 9. 栄養素貯蔵タンクの拡張（1か月規模）

**質問**: 7（栄養素貯蔵タンクの拡張）Geminiは1か月規模の栄養素あるといってたけど

**回答**: 
**現在の実装**: 
- `StorageNutrientGauge`は1週間単位での可視化

**拡張が必要**:
- 1か月単位での可視化に拡張
- ビタミンA等の脂溶性栄養素は数ヶ月持つが、安全マージンを考慮して1か月単位で可視化
- **実装方法**: `StorageNutrientGauge`の計算ロジックを1週間から1か月に拡張

## 10. 移行ガイドの動的アルゴリズム（詳細）

**質問**: 8（移行ガイドの動的アルゴリズム）くわしく

**回答**: 
`CARNIVOS_GEMINI_CONVERSATION_SUMMARY.md`より:

### 専門家知見の統合
- Dr. Ken Berry、Shawn Baker、Paul Saladino、Anthony Chaffee、Bart Kay、Paul Masonの理論をベースにする

### If-Thenプランニング
- **「外食で肉がない時」**: 代替案を自動提示（例：マクドナルドでハンバーガーパティのみを注文）
- **「糖質を欲した時」**: 対処法を自動提示（例：電解質不足の可能性、塩分を増やす）

### 断食の活用
- 必須ではないが、適応を加速させるためのオプション
- ユーザーが選択可能

### 移行期間の動的計算
- 30日固定ではなく、個人差を考慮した柔軟な計算方法
- 症状の種類、重症度、期間に応じて調整

### 症状の自動検出とアドバイス
- ユーザーが「腹痛がする」と言えば、AIが直近のログから原因を推論
- 推論の根拠を表示（どのログから判断したか）

**実装状況**: 
- `TransitionBanner`と`calculateTransitionProgress`が既に実装済み
- ただし、30日固定で、動的計算は未実装
- **実装が必要**: 個人差を考慮した動的計算、If-Thenプランニング、症状の自動検出

## 11. 全画面表示が全画面じゃない

**問題**: 全画面表示が全画面じゃない

**解決策**: 
- CSSを修正して、確実に全画面表示になるように
- `position: fixed`、`width: 100vw`、`height: 100vh`を強制
- `z-index: 99999`で最前面に表示
- `body`の`overflow: hidden`と`position: fixed`でスクロールを無効化

