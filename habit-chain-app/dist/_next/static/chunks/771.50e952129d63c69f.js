"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[771],{542:(e,t,s)=>{s.d(t,{VX:()=>n,lx:()=>r});var a=s(5959),i=s(9863);(0,a.v)()((0,i.Zr)(e=>({user:null,settings:{notification_enabled:!0,ui_color:"blue",sound_enabled:!0},setUser:t=>e({user:t}),updateSettings:t=>e(e=>({settings:{...e.settings,...t}}))}),{name:"user-store"})),(0,a.v)((e,t)=>({habits:[],activeHabits:[],setHabits:t=>e({habits:t,activeHabits:t.filter(e=>e.is_active)}),addHabit:t=>e(e=>({habits:[...e.habits,t],activeHabits:t.is_active?[...e.activeHabits,t]:e.activeHabits})),updateHabit:(t,s)=>e(e=>{let a=e.habits.map(e=>e.id===t?{...e,...s}:e);return{habits:a,activeHabits:a.filter(e=>e.is_active)}}),deleteHabit:t=>e(e=>({habits:e.habits.filter(e=>e.id!==t),activeHabits:e.activeHabits.filter(e=>e.id!==t)})),getActiveHabits:()=>t().activeHabits})),(0,a.v)((e,t)=>({habitRecords:[],simpleRecords:[],addHabitRecord:t=>e(e=>({habitRecords:[...e.habitRecords,t]})),updateHabitRecord:(t,s)=>e(e=>({habitRecords:e.habitRecords.map(e=>e.id===t?{...e,...s}:e)})),addSimpleRecord:t=>e(e=>({simpleRecords:[...e.simpleRecords,t]})),getTodayRecords:()=>{let e=new Date().toISOString().split("T")[0],{habitRecords:s,simpleRecords:a}=t();return{habitRecords:s.filter(t=>t.start_time.startsWith(e)),simpleRecords:a.filter(t=>t.created_at.startsWith(e))}}})),(0,a.v)((e,t)=>({state:{isRunning:!1,elapsedTime:0,targetTime:0,splitTimes:[],isAlternative:!1},currentHabit:null,startTimeAttack:t=>e({currentHabit:t,state:{isRunning:!0,startTime:new Date,elapsedTime:0,targetTime:t.target_duration_seconds,splitTimes:[],isAlternative:!1}}),pauseTimeAttack:()=>e(e=>({state:{...e.state,isRunning:!1}})),resumeTimeAttack:()=>e(e=>({state:{...e.state,isRunning:!0}})),stopTimeAttack:()=>e(e=>({state:{...e.state,isRunning:!1}})),addSplitTime:()=>e(e=>({state:{...e.state,splitTimes:[...e.state.splitTimes,e.state.elapsedTime]}})),setAlternative:t=>e(e=>({state:{...e.state,isAlternative:t}})),resetTimeAttack:()=>e({state:{isRunning:!1,elapsedTime:0,targetTime:0,splitTimes:[],isAlternative:!1},currentHabit:null})}));let r=(0,a.v)(e=>({currentTab:"home",setCurrentTab:t=>e({currentTab:t})}));(0,a.v)((e,t)=>({rewards:[],unclaimedRewards:[],addReward:t=>e(e=>({rewards:[...e.rewards,t],unclaimedRewards:t.claimed?e.unclaimedRewards:[...e.unclaimedRewards,t]})),claimReward:t=>e(e=>({rewards:e.rewards.map(e=>e.id===t?{...e,is_claimed:!0,claimed_at:new Date().toISOString()}:e),unclaimedRewards:e.unclaimedRewards.filter(e=>e.id!==t)})),checkRewards:()=>{}}));let n=(0,a.v)()((0,i.Zr)((e,t)=>({miniApps:[{id:"speedrun",type:"speedrun",name:"習慣スピードラン",description:"If-Then習慣のスピードラン機能",icon:"⚡",isActive:!0,isUnlocked:!0,unlockConditions:{type:"streak_days",value:60},concept:"習慣をスピードラン形式で実行し、タイムを競う",activationMethod:"If-Then習慣の一部として統合"},{id:"diary",type:"diary",name:"日記",description:"成功・失敗・反省・感謝の記録",icon:"\uD83D\uDCD6",isActive:!1,isUnlocked:!1,unlockConditions:{type:"streak_days",value:60},concept:"習慣の振り返りと内省を深める日記機能",activationMethod:"記録画面からアクセス"},{id:"community",type:"community",name:"コミュニティ",description:"他のユーザーとの記録共有",icon:"\uD83D\uDC65",isActive:!1,isUnlocked:!1,unlockConditions:{type:"streak_days",value:60},concept:"他のユーザーと記録を共有し、モチベーションを向上",activationMethod:"ホーム画面のコミュニティカードからアクセス"},{id:"analytics",type:"analytics",name:"詳細分析",description:"高度な統計と分析機能",icon:"\uD83D\uDCC8",isActive:!1,isUnlocked:!1,unlockConditions:{type:"streak_days",value:30},concept:"習慣のパフォーマンスを詳細に分析",activationMethod:"分析画面からアクセス"}],enabledMiniApps:[{id:"speedrun",type:"speedrun",name:"習慣スピードラン",description:"If-Then習慣のスピードラン機能",icon:"⚡",isActive:!0,isUnlocked:!0,unlockConditions:{type:"streak_days",value:60},concept:"習慣をスピードラン形式で実行し、タイムを競う",activationMethod:"If-Then習慣の一部として統合"}],extendedRecords:[],timeAttackChains:[],setMiniApps:t=>e({miniApps:t,enabledMiniApps:t.filter(e=>e.isActive&&e.isUnlocked)}),toggleMiniApp:t=>e(e=>{let s=e.miniApps.map(e=>({...e,isActive:e.id===t}));return{miniApps:s,enabledMiniApps:s.filter(e=>e.isActive&&e.isUnlocked)}}),unlockMiniApp:t=>e(e=>{let s=e.miniApps.map(e=>e.id===t?{...e,isUnlocked:!0}:e);return{miniApps:s,enabledMiniApps:s.filter(e=>e.isActive&&e.isUnlocked)}}),addExtendedRecord:t=>e(e=>({extendedRecords:[...e.extendedRecords,t]})),updateExtendedRecord:(t,s)=>e(e=>({extendedRecords:e.extendedRecords.map(e=>e.id===t?{...e,...s}:e)})),addTimeAttackChain:t=>e(e=>({timeAttackChains:[...e.timeAttackChains,t]})),updateTimeAttackChain:(t,s)=>e(e=>({timeAttackChains:e.timeAttackChains.map(e=>e.id===t?{...e,...s}:e)})),checkUnlockConditions:()=>{let{habits:e}=t(),{miniApps:s}=t();s.forEach(e=>{if(!e.isUnlocked&&e.unlockConditions){let s=!1;switch(e.unlockConditions.type){case"total_records":case"streak_days":case"premium_user":s=!0}s&&t().unlockMiniApp(e.id)}})}}),{name:"miniapp-store"}))},4771:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(5155),i=s(2115),r=s(5626),n=s(3457),l=s(7910),d=s(1169),c=s(1524),o=s(7586),m=s(8519),x=s(2529),p=s(542),h=s(5704);function u(){let{setCurrentTab:e}=(0,p.lx)(),[t,u]=(0,i.useState)(0),[g,b]=(0,i.useState)(""),[v,y]=(0,i.useState)(""),[j,f]=(0,i.useState)("stripe"),[N,w]=(0,i.useState)(!1),[k,A]=(0,i.useState)({total:12450,goal:5e4,donors:23,averageAmount:541}),T=async()=>{if(!(t<=0)){w(!0);try{if(!navigator.onLine){console.log("Offline mode: Using mock donation"),setTimeout(()=>{alert("寄付が完了しました！（モック）\n\xa5".concat(t.toLocaleString(),"の寄付を受け付けました。\n実際の環境ではStripe Checkoutにリダイレクトされます。")),w(!1)},1e3);return}let e=await fetch("/api/create-donation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t,message:v,paymentMethod:j,currency:"jpy"})}),{sessionId:a,error:i}=await e.json();if(i)throw Error(i);let r=await s.e(511).then(s.bind(s,4511)),n=await r.loadStripe(h.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);n&&await n.redirectToCheckout({sessionId:a})}catch(e){console.error("寄付処理エラー:",e),setTimeout(()=>{alert("寄付が完了しました！（モック）\n\xa5".concat(t.toLocaleString(),"の寄付を受け付けました。\n実際の環境ではStripe Checkoutにリダイレクトされます。")),w(!1)},1e3)}finally{navigator.onLine&&w(!1)}}},R=k.total/k.goal*100;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,a.jsx)("div",{className:"px-4 pt-4 pb-2 border-b border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>e("home"),className:"w-8 h-8 flex items-center justify-center hover:bg-gray-800 rounded-lg transition-colors",children:(0,a.jsx)(r.A,{size:20,className:"text-gray-300"})}),(0,a.jsx)("h1",{className:"text-xl font-bold text-white",children:"Gift寄付"})]})}),(0,a.jsxs)("div",{className:"px-4 py-6 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-pink-900 via-purple-900 to-indigo-900 rounded-xl p-6 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white bg-opacity-5 rounded-full -translate-y-16 translate-x-16"}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)(n.A,{className:"w-8 h-8 text-pink-400"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"開発を応援する"})]}),(0,a.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed mb-4",children:"あなたの寄付が、より良い習慣チェーンアプリの開発を支えます。 新しい機能の追加や改善に活用させていただきます。"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(l.A,{size:14}),(0,a.jsx)("span",{children:"安全な決済"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(d.A,{size:14}),(0,a.jsxs)("span",{children:[k.donors,"名の寄付者"]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"今月の寄付統計"}),(0,a.jsx)(c.A,{className:"w-6 h-6 text-green-400"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-yellow-400",children:["\xa5",k.total.toLocaleString()]}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"寄付総額"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-400",children:k.donors}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"寄付者数"})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"目標達成率"}),(0,a.jsxs)("span",{className:"text-white font-medium",children:[R.toFixed(1),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-3",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-yellow-400 to-orange-400 h-3 rounded-full transition-all duration-500",style:{width:"".concat(Math.min(R,100),"%")}})}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["目標: \xa5",k.goal.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-400",children:["平均寄付額: \xa5",k.averageAmount.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"寄付金額を選択"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[500,1e3,2e3,5e3,1e4].map(e=>(0,a.jsxs)("button",{onClick:()=>{u(e),b("")},className:"py-3 px-4 rounded-lg border-2 transition-all ".concat(t===e?"border-pink-500 bg-pink-500 bg-opacity-20 text-pink-400 shadow-lg":"border-gray-600 text-gray-300 hover:border-gray-500 hover:bg-gray-700"),children:["\xa5",e.toLocaleString()]},e))}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"カスタム金額"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\xa5"}),(0,a.jsx)("input",{type:"number",value:g,onChange:e=>{b(e.target.value),u(parseInt(e.target.value)||0)},placeholder:"金額を入力",className:"w-full bg-gray-700 border border-gray-600 rounded-lg pl-8 pr-4 py-3 text-white focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]}),t>0&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-400",children:["選択金額: \xa5",t.toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,a.jsx)(o.A,{className:"w-5 h-5 text-blue-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"サポートメッセージ（任意）"})]}),(0,a.jsx)("textarea",{value:v,onChange:e=>y(e.target.value),placeholder:"開発者へのメッセージや要望があれば...",rows:4,maxLength:200,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-1 text-right",children:[v.length,"/200文字"]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"決済方法"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-3 p-4 rounded-lg border-2 cursor-pointer transition-all ".concat("stripe"===j?"border-blue-500 bg-blue-500 bg-opacity-10":"border-gray-600 hover:border-gray-500"),children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:"stripe",checked:"stripe"===j,onChange:e=>f(e.target.value),className:"text-blue-500"}),(0,a.jsx)(m.A,{className:"w-5 h-5 text-blue-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:"クレジットカード"}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Visa, Mastercard, JCB対応"})]})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-3 p-4 rounded-lg border-2 cursor-pointer transition-all ".concat("paypal"===j?"border-blue-500 bg-blue-500 bg-opacity-10":"border-gray-600 hover:border-gray-500"),children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:"paypal",checked:"paypal"===j,onChange:e=>f(e.target.value),className:"text-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:"PayPal"}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"PayPalアカウントで決済"})]})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-3 p-4 rounded-lg border-2 cursor-pointer transition-all ".concat("apple_pay"===j?"border-blue-500 bg-blue-500 bg-opacity-10":"border-gray-600 hover:border-gray-500"),children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:"apple_pay",checked:"apple_pay"===j,onChange:e=>f(e.target.value),className:"text-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:"Apple Pay"}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Touch ID / Face ID対応"})]})]})]})]}),(0,a.jsx)("button",{onClick:T,disabled:t<=0||N,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed hover:from-pink-600 hover:to-purple-700 transition-all duration-200 shadow-lg relative",children:N?(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"処理中..."})]}):t>0?"\xa5".concat(t.toLocaleString()," を寄付する"):"金額を選択してください"}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"最近の寄付者"}),(0,a.jsx)(d.A,{className:"w-5 h-5 text-blue-400"})]}),(0,a.jsx)("div",{className:"space-y-3",children:[{name:"習慣マスター",amount:5e3,message:"続けてください！",time:"2時間前",verified:!0},{name:"匿名ユーザー",amount:2e3,message:"素晴らしいアプリです！",time:"5時間前",verified:!1},{name:"早起き太郎",amount:1e3,message:"朝活機能が助かります",time:"1日前",verified:!0},{name:"匿名ユーザー",amount:3e3,time:"2日前",verified:!1},{name:"健康第一",amount:1500,message:"運動習慣が身につきました",time:"3日前",verified:!0}].map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-pink-400 to-purple-400 rounded-full flex items-center justify-center",children:(0,a.jsx)(n.A,{size:14,className:"text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-white font-medium",children:e.name}),e.verified&&(0,a.jsx)(x.A,{size:14,className:"text-green-400"})]}),e.message&&(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:e.message}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.time})]})]}),(0,a.jsxs)("div",{className:"text-pink-400 font-semibold",children:["\xa5",e.amount.toLocaleString()]})]},t))})]})]})]})}}}]);