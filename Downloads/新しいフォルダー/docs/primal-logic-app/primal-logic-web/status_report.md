# Primal Logic Web App - 実装状況レポート

**作成日**: 2025年1月  
**プロジェクト**: Primal Logic (Carnivore Compass) - Web版  
**フレームワーク**: React + Vite + TypeScript

---

## 📁 現在のファイル構造

### 主要ディレクトリ

```
primal-logic-web/
├── src/
│   ├── components/          # UIコンポーネント
│   │   ├── butcher/        # 食品選択UI (ButcherSelect.tsx)
│   │   ├── dashboard/       # AI Speed Dial, SymptomChecker
│   │   ├── gauge/          # 栄養素ゲージ (PFRatioGauge, NutrientGauge)
│   │   └── ...             # その他のUIコンポーネント
│   ├── screens/            # 画面コンポーネント
│   │   ├── HomeScreen.tsx  # ホーム画面（栄養ゲージ、食品選択）
│   │   ├── HistoryScreen.tsx # 履歴画面
│   │   ├── ProfileScreen.tsx # プロファイル設定
│   │   ├── KnowledgeScreen.tsx # Logic Armor（理論武装）
│   │   ├── LabsScreen.tsx  # その他（Labs）機能
│   │   └── ...             # その他の画面
│   ├── data/               # データ定義
│   │   ├── foodMaster.ts   # 食品マスターデータ
│   │   ├── carnivoreTargets.ts # カーニボア栄養目標値
│   │   ├── knowledgeBase.ts # Logic Armor知識ベース
│   │   ├── remedyLogic.ts  # 症状対処法ロジック
│   │   ├── tips.ts         # Tips（豆知識）データ
│   │   └── ...             # その他のデータファイル
│   ├── utils/              # ユーティリティ関数
│   │   ├── storage.ts      # localStorage操作
│   │   ├── streakCalculator.ts # ストリーク計算
│   │   ├── nutrientCalculator.ts # 栄養素計算
│   │   └── ...             # その他のユーティリティ
│   ├── hooks/              # カスタムフック
│   │   ├── useNutrition.ts # 栄養素管理
│   │   ├── useUserConfig.ts # ユーザー設定
│   │   └── useSettings.ts  # 設定管理
│   ├── context/            # グローバル状態管理
│   │   ├── AppContext.tsx  # アプリケーション状態
│   │   └── LanguageContext.tsx # 多言語対応（未使用）
│   └── types/              # TypeScript型定義
│       └── index.ts        # 共通型定義
├── public/                 # 静的ファイル
├── package.json            # 依存関係
├── vite.config.ts          # Vite設定
├── tailwind.config.js      # Tailwind CSS設定
└── tsconfig.json           # TypeScript設定
```

---

## ✅ 実装済みの主要機能

### 1. **食品選択・記録機能**
- ✅ **ButcherSelectコンポーネント**: 動物（牛・豚・鶏・魚・卵・乳製品・脂質）と部位を選択
- ✅ **リアルタイム栄養素計算**: 選択中の食品の栄養素をプレビュー表示
- ✅ **量調整**: スライダーまたは数値入力で量を調整
- ✅ **栄養素内訳表示**: タンパク質、脂質、ミネラル、ビタミンなどの詳細表示
- ✅ **食品追加**: 選択した食品を日次ログに追加

### 2. **栄養素ゲージ（Anxiety-Free Gauges）**
- ✅ **4-Zone Gradient Gauge**: 不足/安全圏/理想/過剰の4ゾーン表示
- ✅ **複数栄養素対応**: タンパク質、脂質、亜鉛、マグネシウム、鉄、ビタミンB12、ナトリウムなど
- ✅ **リアルタイム更新**: 食品追加時に自動更新
- ✅ **プレビュー機能**: 選択中の食品の影響をプレビュー表示

### 3. **AI機能**
- ✅ **AI Speed Dial**: 右下に展開式ボタン（✨）でAI機能にアクセス
  - 📸 **写真入力**: 食品写真から栄養素を検出（モック実装）
  - 💬 **AIチャット**: 症状に関する質問に回答（キーワードベース）
- ✅ **症状対処法**: 頭痛、こむら返り、便秘、関節痛などへの対処法を表示
- ✅ **Tips（豆知識）**: ランダム表示機能と履歴管理

### 4. **🛡️ Logic Armor（理論武装）**
- ✅ **KnowledgeScreen**: カーニボアに対する誤解（Myth）と真実（Truth）をカード形式で表示
- ✅ **カテゴリフィルター**: 消化、心臓、長期健康、栄養などでフィルタリング
- ✅ **フリップカードUI**: タップでMythからTruthに切り替え
- ✅ **「その他」画面への統合**: ナビゲーションから削除し、Labs画面からアクセス可能

### 5. **🔥 習慣トラッカー（ストリーク機能）**
- ✅ **ストリーク計算**: 連続記録日数を計算
- ✅ **フェーズ（称号）システム**: 
  - Rookie (0日)
  - Carnivore (7日)
  - Hunter (30日)
  - Predator (90日)
  - Apex (180日)
  - Legend (365日)
- ✅ **最長連続日数記録**: 過去の最長記録を表示
- ✅ **次のフェーズまでの日数表示**: モチベーション向上

### 6. **その他（Labs）機能**
- ✅ **LabsScreen**: 実験的機能を集約
  - 🛡️ Logic Armorへのアクセス
  - 🔥 習慣トラッカー
  - 💡 Tips設定と履歴
- ✅ **Tips履歴**: 過去に表示されたTipsを再読可能
- ✅ **Tips ON/OFF設定**: 機能の有効/無効を切り替え

### 7. **履歴・プロファイル機能**
- ✅ **HistoryScreen**: 過去の日次ログを表示
- ✅ **ProfileScreen**: ユーザー設定（目標値、許容量など）
- ✅ **日次ログ管理**: localStorageで日次データを保存

### 8. **UI/UX**
- ✅ **モバイルファーストデザイン**: スマホ画面を最優先
- ✅ **Tailwind CSS**: モダンなスタイリング
- ✅ **下部ナビゲーション**: ホーム、履歴、その他、プロファイル
- ✅ **レスポンシブデザイン**: タッチフレンドリーなUI

---

## ⚠️ 未実装・中途半端な部分

### 1. **Supabase連携（完全未実装）**
- ❌ Supabaseクライアントの初期化なし
- ❌ 認証機能なし（ログイン/サインアップ）
- ❌ データベース連携なし（すべてlocalStorage）
- ❌ Row Level Security (RLS) の設定なし
- ❌ セッション管理なし

**影響**: 
- データはブラウザのlocalStorageにのみ保存
- 複数デバイス間での同期不可
- データ消失リスク（ブラウザデータ削除時）

### 2. **データの永続化（部分実装）**
- ✅ localStorageで日次ログを保存
- ❌ クラウドバックアップなし
- ❌ データエクスポート機能なし
- ❌ データインポート機能なし
- ❌ データ復元機能なし

### 3. **エラーハンドリング（不十分）**
- ⚠️ API呼び出し時のエラーハンドリングが限定的
- ⚠️ ネットワークエラー時の処理なし
- ⚠️ ストレージエラー時の処理なし
- ❌ エラーログ収集（Sentry等）なし
- ❌ ユーザー向けエラーメッセージが不統一

**例**: 
- `storage.ts`では`try-catch`でエラーをキャッチしているが、ユーザーへの通知は限定的
- `AISpeedDial.tsx`のチャット機能ではエラーハンドリングが不足

### 4. **AI機能（部分実装）**
- ⚠️ **Gemini API統合**: 環境変数は定義されているが、実際のAPI呼び出しは未実装
- ⚠️ **OpenAI API**: `openaiApi.ts`に実装があるが、使用箇所が限定的
- ⚠️ **写真解析**: モック実装のみ（実際の画像認識なし）
- ⚠️ **音声入力**: 未実装（UIのみ存在）

### 5. **多言語対応（未使用）**
- ❌ `LanguageContext.tsx`は存在するが、実際には使用されていない
- ❌ 翻訳ファイルなし
- ❌ i18n実装なし

### 6. **通知機能（未実装）**
- ❌ ブラウザ通知APIの実装なし
- ❌ リマインダー機能なし
- ❌ プッシュ通知なし

### 7. **テスト（未実装）**
- ❌ ユニットテストなし
- ❌ 統合テストなし
- ❌ E2Eテストなし

### 8. **パフォーマンス最適化（部分実装）**
- ✅ React.memo、useMemo、useCallbackを一部使用
- ❌ コード分割（Code Splitting）なし
- ❌ 画像最適化なし
- ❌ バンドルサイズ最適化なし

---

## 📦 使用している主要なライブラリ

### 依存関係（package.jsonより）

```json
{
  "dependencies": {
    "react": "19.2.0",
    "react-dom": "19.2.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^5.1.1",
    "typescript": "~5.9.3",
    "vite": "^7.2.4",
    "tailwindcss": "^4.1.18",
    "eslint": "^9.39.1"
  }
}
```

### 主要技術スタック
- **React 19.2.0**: UIライブラリ
- **Vite 7.2.4**: ビルドツール・開発サーバー
- **TypeScript 5.9.3**: 型安全性
- **Tailwind CSS 4.1.18**: スタイリング
- **ESLint**: コード品質チェック

### 外部サービス（未統合）
- **Gemini API**: AI機能用（環境変数定義済み、実装未完了）
- **OpenAI API**: 従来のAIチャット用（部分実装）
- **Supabase**: バックエンド・認証（未実装）

---

## 🔧 環境変数

### 必要な環境変数（.envファイル）

```env
# Gemini API キー（AI機能用）
VITE_GEMINI_API_KEY=your_gemini_api_key_here

# OpenAI API キー（オプション、従来のAIチャット用）
VITE_OPENAI_API_KEY=your_openai_api_key_here
```

### 未設定の環境変数（将来必要）
```env
# Supabase連携用（未実装）
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

---

## 🎯 次に着手すべき技術的な課題

### 優先度: 高

1. **Supabase連携の実装**
   - Supabaseクライアントの初期化
   - 認証機能（ログイン/サインアップ/ログアウト）
   - データベーススキーマ設計
   - RLSポリシーの設定
   - localStorageからSupabaseへの移行
   - セッション管理

2. **エラーハンドリングの強化**
   - 統一されたエラーハンドリング関数
   - ユーザー向けエラーメッセージの標準化
   - ネットワークエラー時のリトライ機能
   - エラーログ収集（Sentry等の導入検討）

3. **Gemini API統合の完了**
   - AIチャット機能へのGemini API統合
   - 写真解析機能の実装（Vision API）
   - エラーハンドリングとレート制限対応

### 優先度: 中

4. **データ永続化の改善**
   - クラウドバックアップ機能
   - データエクスポート/インポート機能
   - オフライン対応（Service Worker）

5. **パフォーマンス最適化**
   - コード分割の実装
   - 画像最適化
   - バンドルサイズの削減
   - レンダリング最適化

6. **テストの実装**
   - ユニットテスト（Vitest等）
   - 統合テスト
   - E2Eテスト（Playwright等）

### 優先度: 低

7. **多言語対応**
   - i18nライブラリの導入
   - 翻訳ファイルの作成
   - LanguageContextの実装

8. **通知機能**
   - ブラウザ通知APIの実装
   - リマインダー機能
   - プッシュ通知（将来）

9. **アクセシビリティの改善**
   - ARIA属性の追加
   - キーボードナビゲーションの改善
   - スクリーンリーダー対応

---

## 📊 実装進捗率（概算）

| カテゴリ | 進捗率 | 備考 |
|---------|--------|------|
| UI/UX | 90% | 主要画面は完成 |
| 食品選択・記録 | 95% | ほぼ完成 |
| 栄養素計算 | 90% | 主要栄養素は対応済み |
| AI機能 | 30% | UIは完成、API統合が未完了 |
| データ永続化 | 40% | localStorageのみ、クラウド未対応 |
| 認証・セキュリティ | 0% | Supabase未実装 |
| エラーハンドリング | 30% | 基本的な処理のみ |
| テスト | 0% | 未実装 |

**総合進捗率**: 約 **60%**

---

## 🔍 技術的負債

1. **型安全性**: 一部で`any`型を使用している箇所がある
2. **コード重複**: 類似のロジックが複数箇所に散在
3. **状態管理**: Context APIのみで、複雑な状態管理には不十分な可能性
4. **ドキュメント**: コードコメントが不足している箇所がある

---

## 📝 補足情報

### 開発環境
- **Node.js**: 推奨バージョン未記載（package.jsonに記載なし）
- **パッケージマネージャー**: npm（package-lock.jsonが存在）

### ビルド・デプロイ
- **開発サーバー**: `npm run dev` (Vite)
- **ビルド**: `npm run build` (Vite)
- **プレビュー**: `npm run preview` (Vite)
- **デプロイ**: 未設定（Vercel、Netlify等へのデプロイ手順なし）

### 既知の問題
- Magic Input機能は削除済み（AIチャットモーダルに統合）
- 音声入力機能は未実装
- Supabase連携は完全に未実装

---

**このレポートは、Gemini AIにプロジェクトの現状を報告するために作成されました。**
**最終更新**: 2025年1月

