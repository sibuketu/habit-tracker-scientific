# UIアーキテクチャ分析レポート

**作成日**: 2026-01-25  
**目的**: Geminiとの会話を踏まえた、栄養素UIの現状分析と将来の拡張可能性

---

## 1. 現在のUIとロジックの分離状況

### ✅ 良好な分離

#### 1.1 表示コンポーネント（UI層）
- **`MiniNutrientGauge.tsx`**: 表示専用コンポーネント
  - Propsでデータを受け取る（`currentDailyTotal`, `target`, `color`など）
  - 計算ロジックを含まない
  - **交換可能**: 別のUIコンポーネントに置き換え可能

#### 1.2 ロジック層（データ処理）
- **`nutrientCalculator.ts`**: 栄養計算ロジック
  - UI非依存
  - 純粋な計算関数
- **`gaugeUtils.ts`**: 色・ステータス計算
  - UI非依存
  - 再利用可能

#### 1.3 データ取得層
- **`HomeScreen.tsx`**: データ取得とコンポーネントへの受け渡し
  - `useApp()`でデータ取得
  - コンポーネントにpropsで渡す
  - **交換可能**: 別のUIコンポーネントに同じデータを渡せる

### 結論
**UIとロジックは適切に分離されているため、Geminiが提案した新しいUIタイプ（レーダーチャート、リング、グリッド、アバター）に後から交換可能です。**

---

## 2. 現在実装されている栄養素UIタイプ

### 実装済み

1. **ゲージ（バー型）** - `MiniNutrientGauge`
   - 横バー形式のプログレスバー
   - 現在の摂取量/目標量を表示
   - プレビュー機能あり（追加予定の栄養素を表示）

2. **比率ゲージ**
   - `PFRatioGauge`: タンパク質/脂質比率
   - `OmegaRatioGauge`: オメガ3/オメガ6比率
   - `CalciumPhosphorusRatioGauge`: カルシウム/リン比率

### 未実装（Geminiが言及した5種類）

1. **レーダーチャート（6角形）** - 未実装
   - PFCバランスや栄養の偏りを可視化
   - RPGのステータス画面風

2. **リング（ドーナツチャート）** - 未実装
   - Apple Watchのアクティビティリング風
   - 省スペースでスタイリッシュ

3. **グリッド（カード型）** - 未実装
   - ビタミン・ミネラルをカード形式で一覧
   - コンプリート感を演出

4. **アバター（ボディマップ）** - 未実装
   - 栄養が体のどこに効くかを可視化
   - 筋肉、臓器などが光る演出

---

## 3. UI交換の実装方針

### 3.1 現在の設計の利点

現在の設計では、以下のようにUIを交換できます：

```typescript
// 現在: MiniNutrientGauge（バー型）
<MiniNutrientGauge
  label={label}
  currentDailyTotal={nutrients[key]}
  target={dynamicTargets[key]}
  unit={unit}
  color={color}
/>

// 将来: RadarChartNutrientGauge（レーダーチャート型）に交換可能
<RadarChartNutrientGauge
  label={label}
  currentDailyTotal={nutrients[key]}
  target={dynamicTargets[key]}
  unit={unit}
  color={color}
/>
```

**同じpropsインターフェースを保てば、コンポーネントの置き換えだけでUIを変更できます。**

### 3.2 推奨される実装方法

1. **共通インターフェースの定義**
   ```typescript
   interface NutrientDisplayProps {
     label: string;
     currentDailyTotal: number;
     target: number;
     unit: string;
     color: string;
     nutrientKey: string;
   }
   ```

2. **UIタイプの選択機能**
   - 設定画面でUIタイプを選択可能にする
   - バー型、レーダーチャート、リング、グリッド、アバター

3. **段階的な実装**
   - Phase 1: 現在のバー型を維持
   - Phase 2: レーダーチャートを追加（オプション）
   - Phase 3: リング、グリッド、アバターを追加

---

## 4. Geminiとの会話から得られた知見

### 4.1 UIタイプの使い分け

- **バランス重視（PFCなど）** → レーダーチャート（6角形）
- **目標達成重視（カロリーなど）** → ゲージ（バー）← **現在実装済み**
- **一覧性・お洒落さ重視** → リング
- **多品目管理（ビタミン類）** → グリッド
- **育成感重視** → アバター

### 4.2 リリース後の改善フロー

1. アプリのスクリーンショットをGeminiに送信
2. Geminiが分析＆代替案を提示
3. 代替案の画像を引用
4. 実装前に「正解」のイメージを確認
5. UIコンポーネントを交換

**このフローは、現在の設計（UIとロジックの分離）により実現可能です。**

---

## 5. 次のステップ

### 即座に対応すべき問題
1. ✅ LabsScreenの表示問題を修正
2. ✅ 残りの文字化けを修正

### 将来の拡張
1. レーダーチャートUIの実装（オプション）
2. リングUIの実装（オプション）
3. UIタイプ選択機能の追加（設定画面）

---

**結論**: 現在のアーキテクチャは、Geminiが提案した新しいUIタイプに後から交換できる設計になっています。リリース後も、スクリーンショットを送れば代替案を提示し、UIだけを交換することが可能です。
