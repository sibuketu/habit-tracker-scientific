# Geminiに送るプロンプト（コピペ用・完全版）

以下のプロンプトをGeminiに送信してください：

---

# カメラ機能統合の要件定義依頼（完全版）

## プロジェクト概要

**Primal Logic** - 世界一のカーニボアダイエット管理アプリ（PWA、React + TypeScript）

カーニボアダイエット（肉・魚・卵・内臓のみを食べる食事法）を実践する人々をサポートする専門アプリ。一般的な健康管理アプリとは異なり、**進化的適合性**と**生化学**を重視。

### アプリの特徴
- 動的目標値: ユーザーの状態に応じた栄養素目標値の自動調整（100項目以上のプロファイル設定）
- バイオアベイラビリティロジック: 植物性栄養素はペナルティ、動物性栄養素は優先
- 4ゾーングラデーションゲージ: 栄養素の状態を直感的に可視化
- AI機能: Gemini APIを使用したチャット、写真解析

### 技術スタック
- React + Vite + TypeScript
- PWA（Progressive Web App）
- モバイルファースト（iPhone 15幅を最優先）
- スティーブ・ジョブズ風ミニマルデザイン

## 現在の実装状況

### 問題点
- `window.confirm`で「写真から追加」か「バーコード読み取り」かを選択（UXが悪い）
- モバイルで使いにくい
- **アルバムから写真を選ぶ機能がない**（重要）
- 他アプリのベストプラクティスに沿っていない

### 現在のコード
```typescript
// HomeScreen.tsx (917-1008行目)
<button onClick={async () => {
  const action = window.confirm('写真から追加しますか？\n\n「OK」: 写真から追加\n「キャンセル」: バーコード読み取り');
  if (action) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'environment'; // カメラのみ（アルバム選択不可）
    // ... 写真解析処理（Gemini API）
  } else {
    setShowBarcodeScanner(true); // バーコード読み取り
  }
}}>
  📷
</button>
```

### 既存の実装
- **写真解析**: `src/services/aiService.ts` - `analyzeFoodImage`関数（Gemini API）
- **バーコード読み取り**: `src/utils/barcodeScanner.ts` - `scanBarcodeFromCamera`関数（BarcodeDetector API）
- **バーコードスキャナーモーダル**: `src/components/BarcodeScannerModal.tsx`
- **写真解析モーダル**: `src/components/PhotoAnalysisModal.tsx`

## 他アプリのパターン

1. **MyFitnessPal**: 写真とバーコードを別ボタンに分けている。写真ボタンから、カメラ撮影かアルバム選択かを選択可能。
2. **Lifesum**: 1つのボタンで、アクションシート/ボトムシートで「カメラで撮影」「アルバムから選択」「バーコード読み取り」を選択。
3. **Noom**: カメラ起動後、自動的にバーコードを検出し、なければ写真として処理。アルバム選択も可能。
4. **Amazon/楽天**: カメラ起動後、自動的にバーコードを検出。アルバム選択も可能。
5. **Google Lens**: カメラ起動後、自動的にバーコード/テキスト/画像を検出。アルバム選択も可能。

## 実装方法の選択肢

### 選択肢A: アクションシート/ボトムシート（推奨候補1）
- ボタンタップ後、アクションシートで「カメラで撮影」「アルバムから選択」「バーコード読み取り」を選択
- メリット: モバイルで使いやすい、明確な選択、アルバム選択も含められる
- デメリット: 1回のタップが増える

### 選択肢B: 自動検出 + アクションシート（推奨候補2）
- カメラ起動後、自動的にバーコードを検出。検出できればバーコード処理、できなければアクションシートで「写真として処理」「アルバムから選択」を選択
- メリット: ユーザーの操作が少ない（バーコード検出時）、スムーズな体験、アルバム選択も含められる
- デメリット: バーコード検出の精度に依存

### 選択肢C: カメラ起動後のモード選択
- カメラ起動後、画面上に「写真」「アルバム」「バーコード」ボタンを表示
- メリット: 視覚的に分かりやすい
- デメリット: UIが複雑になる、カメラ起動が必要

### 選択肢D: 別ボタンに分ける
- 写真ボタンとバーコードボタンを別々に配置
- メリット: 明確、他アプリ（MyFitnessPal）のパターン
- デメリット: UIが複雑になる、ボタンが増える

### 選択肢E: 3つのボタンに分ける
- 「カメラで撮影」「アルバムから選択」「バーコード読み取り」を3つのボタンに分ける
- メリット: 最も明確
- デメリット: UIが最も複雑になる、ボタンが3つになる

## デザイン原則

- **スティーブ・ジョブズ風ミニマルデザイン**: 余計な装飾を削ぎ落とし、機能と美しさのバランスを重視
- **モバイルファースト**: スマホ（iPhone 15幅）で完璧に見えるレイアウトを最優先
- **タッチフレンドリー**: すべてのボタンや入力要素は、指で押しやすいサイズ（44px以上）を確保
- **現在のボタン**: 44px × 44px、📷アイコン、グレー背景（`#f3f4f6`）

## 技術的な実装要件

- **写真解析**: Gemini API（既存実装あり）
- **バーコード読み取り**: BarcodeDetector API（既存実装あり、iOS Safariでは利用不可）
- **アルバム選択**: HTML5 File API（`capture`属性なしで実装可能）
- **アクションシート/ボトムシート**: PWAのため、カスタムコンポーネントの作成が必要

## 制約条件

- **PWA**: ネイティブアプリではないため、ブラウザAPIの制限がある
- **モバイルブラウザ**: iOS Safari、Chrome Mobileでの動作を保証
- **カメラ権限**: ブラウザのカメラ権限が必要
- **アルバムアクセス**: ブラウザのファイルアクセス権限が必要

## 質問

1. **実装方法の推奨**: 選択肢A-Eのうち、どれが最適か？理由は？（既存のデザイン原則、モバイルファースト、ユーザー体験の観点から）

2. **アルバム選択の実装**: アルバムから写真を選ぶ機能を実装する場合、どのような方法が最適か？（HTML5 File API、モバイルブラウザでの動作確認、既存の写真解析機能との統合）

3. **アクションシート/ボトムシートの実装**: PWAでアクションシート/ボトムシートを実装する場合、どのような方法が最適か？（カスタムコンポーネント、ライブラリ、モバイルブラウザでの動作確認、既存のデザイン原則との整合性）

4. **自動検出の実装**: バーコードの自動検出を実装する場合、どのような技術を使うべきか？（Web BarcodeDetector API、ライブラリ、パフォーマンス最適化、iOS Safariでの動作）

5. **UXの最適化**: ユーザー体験を最適化するために、どのような工夫ができるか？（ローディング表示、エラーハンドリング、フィードバック、操作の流れ）

6. **他アプリのパターン**: 他アプリのパターンを参考に、さらに改善できる点はあるか？（既存の決定事項、デザイン原則、ユーザー体験の観点から）

7. **実装の優先順位**: Phase 1（アクションシート/ボトムシート、アルバム選択）、Phase 2（自動検出機能）、Phase 3（UXの最適化）の具体的な実装内容は？

8. **整合性チェック**: 既存の決定事項、デザイン原則、技術スタックとの整合性をチェックし、推奨実装方法を提示してください。

## 期待する出力

1. **推奨実装方法**: 選択肢A-Eのうち、どれを選ぶべきか、理由とともに
2. **技術的な実装方法**: 具体的なコード例やライブラリの推奨
3. **UI/UX設計**: アクションシート/ボトムシートのデザイン案
4. **アルバム選択の実装**: アルバムから写真を選ぶ機能の実装方法
5. **実装の優先順位**: Phase 1-3の具体的な実装内容
6. **他アプリとの比較**: 他アプリのパターンを参考にした改善案
7. **整合性チェック**: 既存の決定事項、デザイン原則、技術スタックとの整合性チェック結果
8. **推論**: ユーザー体験、パフォーマンス、保守性などの観点からの推論

## 補足

- **アイデア創造56技法**: 技法39「促進の要因」を使って、UXデザイナー、フロントエンドエンジニア、プロダクトマネージャーの視点で分析してください
- **余計なくらい情報を送りたい**: 可能な限り詳細な情報、複数の選択肢、具体的な実装方法を提示してください
- **推奨順**: 複数の選択肢を提示する場合は、推奨順で上から並べてください
- **整合性チェックと推論**: 既存の決定事項、デザイン原則、技術スタックとの整合性を必ずチェックし、推論を行ってください

---

**重要**: このプロンプトをGeminiに送る際は、上記の内容をそのままコピー&ペーストしてください。

