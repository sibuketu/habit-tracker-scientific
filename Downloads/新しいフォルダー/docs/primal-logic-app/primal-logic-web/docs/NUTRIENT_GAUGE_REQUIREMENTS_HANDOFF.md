# 栄養ゲージ統合実装 - 要件定義引き継ぎメモ

**作成日**: 2026-01-22  
**目的**: 別のAgentへの引き継ぎ用メモ

## 実装方針（重要）

**基本方針**: HomeScreenに1個完璧な実装を作り、他はコピーする

1. **HomeScreen**: 基準実装（完璧版）
   - グループ化表示（電解質、マクロ、その他）
   - モード別タップ回数（Simple/Standard/Detailed）
   - 動的target、単位統一
   - Tier1/Tier2/Tier3の表示制御

2. **他画面への適用**: HomeScreenの実装をコピー
   - CustomFoodScreen: ✅ 適用済み
   - HistoryScreen: ✅ 適用済み（日別展開表示など独自機能は維持）

3. **独自機能の扱い**: 
   - HistoryScreenの日別展開表示など、画面固有の機能は後で使い回す可能性があるため維持

---

## 決定事項

### モード別タップ回数（正しい理解）

- **Simpleモード**: 0タップ（Tier1のみ表示）
- **Standardモード**: 1タップ（Tier1表示、Tier2をタップで展開）
- **Detailedモード**: 0タップ（Tier1 + Tier2 + Tier3が全て自動展開、タップ不要）

**理由**: Detailedはデータ重視ユーザー向けの機能。データ重視ユーザーは「全部見たい」ので、タップ不要で全部見れるべき。

### セクション1とセクション2の関係

- **セクション1（現状分析）**: 無視＝採用
- **セクション2（統合要件定義）**: セクション1で抽出した良い要素を統合して、全画面に適用するための要件定義
- **注意**: セクション1の要素は除外しない。無視＝採用なので、そのまま統合要件定義に含める

### 栄養素数値の修正機能（8番）

- **私の意見**: Detailedモードで実装するのが良い。基本的には合っているから、詳細確認が必要な時だけ修正できるようにする。Simple/Standardモードでは不要。

### CustomFoodScreenについて

- 主に肉以外の検索で使う（牛→部位のUIで肉はカバー済み）
- 検索機能がある画面
- 100g固定targetを動的targetに変更

### 比較が必要な要素

- HomeScreen方式（nutrientDataMap） vs RecipeScreen方式（nutrientGauges配列）の比較は除外
- 無視＝採用のため

### ナンバリングについて

- 各セクションで独立したナンバリングを使用
- 統一ルールはない

---

## Geminiとの会話（画像のUIについて）

**質問**: このUI、100点？別のある？ここにあるの以外は検索してもらうっていう感じだけど肉食でOKな奴は全部ここに入れても大丈夫かの数を知りたい。数は何個までならOKなのか何入れるのか知りたい。

**Geminiの回答**:

このUI、95点です。めちゃくちゃ良いです。私の前回の「パターンC（スーパーマーケット方式）」に近いですが、アイコンでタブ切り替えするこの形は、直感的で最強に速いです。

ご質問の核心である**「検索なしで、カーニボアの全食材をこのUIに入れ込んでも大丈夫か？」**に対する答えは、 「余裕で大丈夫（YES）」 です。

なぜなら、厳格なカーニボアが食べる食材は、細かく分けても全部で約40〜45個しかないからです。 このUIなら、アイコン（タブ）が6個あるので、1タブあたり平均7〜8個、最大でも12個程度のボタン配置で済みます。スクロールすらほぼ不要で、一画面に収まります。

では、**「100点にするために、どのアイコンの中に何を入れればいいか（全リスト）」**を、画像のアイコンに合わせて整理しました。これをそのまま実装すればOKです。

【アイコン別・全食材配置リスト】
（画像の左から順に、中身のボタン数を最適化しました）

1. 🐮 牛アイコン（The King）
ボタン数：10個（これで完璧です） 画像にある6個に、重要な4個を足します。

牛リブロース（リブアイ）

牛サーロイン

牛ひき肉

牛バラ / ブリスケット

牛肩ロース

牛レバー

牛ハツ（心臓） ←安くて重要

牛タン

牛脂（ヘット） ←超重要（エネルギー源）

ボーンブロス（牛骨）

2. 🐷 豚アイコン
ボタン数：5個

豚バラ肉（一番脂が多い）

豚ロース / 肩ロース

ベーコン（無添加）

ラード（豚脂）

豚足（コラーゲン用）

3. 🐔 鶏アイコン（鳥類）
ボタン数：5個

鶏皮（脂質確保用）

鶏手羽（先・元）

鶏もも肉（皮付き）

鶏レバー / 砂肝

（※胸肉・ささみはカーニボア的に優先度が低いので、あえて入れなくてもOK。入れるなら5個目）

4. 🥚 卵アイコン
ボタン数：3個

鶏卵（全卵）

卵黄のみ（栄養重視）

うずらの卵

5. 🧈 脂質・乳製品アイコン（チーズ/バター）
ボタン数：5個 ※ここに「調味料（塩）」も入れてしまうのがUI的に賢いです。

バター（グラスフェッド）

ギー

チーズ（ハードチーズ）

生クリーム

塩（ぬちまーす等） ←これをここに配置！

6. 🐟 魚アイコン
ボタン数：9〜10個 ここが一番多くなりますが、グリッドなら余裕で収まります。

サバ（鯖）

イワシ（鰯）

サーモン（鮭）

カツオ / マグロ

牡蠣（カキ）

白身魚（タラ・タイ）

エビ / カニ

イカ / タコ

魚卵（いくら・たらこ）

魚の缶詰（水煮）

修正・改善のアドバイス（残り5点を埋めるために）
① 「水」と「サプリ」の場所問題 今の6個のアイコンだと「水・炭酸水」や「マグネシウムサプリ」の行き場がありません。

案A: 「🧈脂質」タブの中に「水」「サプリ」も入れて、タブ名を「その他（Essentials）」という扱いに変える。

案B: 右端にもう一個「🥤飲み物/他」アイコンを足す。 → 案Aの方がスマートでおすすめです。

② ボタンの並び順 各タブの中で、ボタンを「あいうえお順」ではなく**「食べるべき優先順位（Tier表）」**の順に並べてください。 （例：牛タブなら、左上に「リブロース」、その隣に「ひき肉」。「牛タン」などは下の方へ）

結論： 今のUIデザインで検索窓は完全に削除してOKです。 上記の分類でボタンを作れば、ユーザーは「タブ切り替え→ボタン押し」の最速2タップですべての記録を完了できます。これは既存アプリより圧倒的に使いやすいはずです。

---

## 実装状況（2026-01-22更新）

### ✅ 実装完了
- **HomeScreen**: グループ化表示、モード別タップ回数、動的target、単位統一、CSSクラス化、翻訳キー追加 ✅
- **CustomFoodScreen**: 100g固定→動的target変更、グループ化表示追加 ✅
- **HistoryScreen**: Summaryタブ・Logsタブ両方にグループ化表示適用、Tier3のハードコードtarget→動的target変更 ✅

### 🔧 技術的改善完了（2026-01-22）
- **HomeScreen**: インラインスタイルをCSSクラスに変換（`.nutrient-group`等）
- **HomeScreen**: ハードコードされた色をCSS変数に変換（`--nutrient-group-electrolytes-bg`等）
- **翻訳キー**: `home.electrolytes`, `home.macros`, `home.otherNutrients`を全言語に追加
- **CSSクラス**: `minigauge-grid`, `expand-nutrients-btn`を追加

### 📝 今後のアプデで検討
- **RecipeScreen**: 詳細は [RELEASE_TODO.md](../RELEASE_TODO.md) のPhase 2セクションを参照
  - **決定**: 今は実装しない（料理をそんなにしないため、優先度低）
  - **今後のアプデ**: HomeScreen方式（グループ化表示）を適用し、レシピ特有の要件を検討

- **PhotoAnalysisModal**: 現在は栄養ゲージを表示していない（モック実装）
  - **今後の実装時**: 栄養ゲージを追加する際に、HomeScreen方式（電解質グループ、マクログループ、その他グループの3つのグループ化表示）を適用する

### Geminiとの会話の使い方
- **現状**: HANDOFF.mdに「UI for food selection」の会話が記載されている
- **内容**: カーニボア食材を6つのアイコンタブ（牛、豚、鶏、卵、脂質/乳製品、魚）に分類するUI設計
- **提案**: 
  - このアイデアは`ButcherSelect`や`CustomFoodScreen`の改善に活用可能
  - Rulesに明示的に記載する必要はない（HANDOFF.mdに記録済み）
  - 実装時に参照する

### 📝 今後のアプデで検討（Geminiとの会話から）
- **食べるべき食品を動的に変える機能**
  - **概要**: 栄養素の不足状況に基づいて、推奨食品を動的に変更する機能
  - **例**: マグネシウム不足なら魚を推奨、カリウム不足なら特定の肉を推奨など
  - **実装方針**: 
    - 栄養ゲージの不足状態を検出
    - 不足している栄養素を多く含む食品をデータベースから検索
    - `ButcherSelect`や`InputScreen`で推奨食品をハイライト表示
    - 詳細はGeminiとの会話ログを参照
  - **優先度**: 低（今後のアプデで検討）

---

**使用したRules**: #0, #1, #2, #5, #6, #8, #10
